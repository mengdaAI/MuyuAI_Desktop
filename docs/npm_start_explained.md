# npm start å¯åŠ¨æµç¨‹è¯¦è§£

## ğŸ¯ æ ¸å¿ƒç­”æ¡ˆ

**`npm start` å¯åŠ¨çš„æ˜¯ä¸€ä¸ª Electron æ¡Œé¢åº”ç”¨**ï¼Œä¸æ˜¯é™æ€æœåŠ¡å™¨ï¼

---

## ğŸ“Š å¯åŠ¨æµç¨‹å›¾

```mermaid
graph TD
    A[npm start] --> B[npm run build:renderer]
    B --> C[node build.js]
    C --> D[esbuild ç¼–è¯‘ UI ä»£ç ]
    D --> E[ç”Ÿæˆ public/build/header.js]
    D --> F[ç”Ÿæˆ public/build/content.js]
    E --> G[node electron/cli.js .]
    F --> G
    G --> H[å¯åŠ¨ Electron ä¸»è¿›ç¨‹]
    H --> I[åŠ è½½ src/index.js]
    I --> J[åˆå§‹åŒ–æ•°æ®åº“]
    I --> K[åˆå§‹åŒ–æœåŠ¡]
    I --> L[åˆ›å»ºçª—å£]
    L --> M[åŠ è½½ HTML æ–‡ä»¶]
    M --> N[æ˜¾ç¤º Electron çª—å£]
```

---

## ğŸ” è¯¦ç»†æ­¥éª¤è§£æ

### **æ­¥éª¤ 1: æ„å»ºæ¸²æŸ“è¿›ç¨‹ä»£ç **
```bash
npm run build:renderer
```

**ä½œç”¨**: ä½¿ç”¨ esbuild ç¼–è¯‘ UI ä»£ç 

**è¾“å…¥æ–‡ä»¶**:
- `src/ui/app/HeaderController.js` â†’ ä¸»çª—å£æ§åˆ¶å™¨
- `src/ui/app/PickleGlassApp.js` â†’ å†…å®¹çª—å£ç»„ä»¶

**è¾“å‡ºæ–‡ä»¶**:
- `public/build/header.js` (ç¼–è¯‘åçš„å¤´éƒ¨ä»£ç )
- `public/build/content.js` (ç¼–è¯‘åçš„å†…å®¹ä»£ç )

**ä¸ºä»€ä¹ˆéœ€è¦ç¼–è¯‘ï¼Ÿ**
- å°† JSX è½¬æ¢ä¸ºæ™®é€š JavaScript
- æ‰“åŒ…æ‰€æœ‰ä¾èµ–åˆ°å•ä¸ªæ–‡ä»¶
- ç”Ÿæˆ source maps ç”¨äºè°ƒè¯•

---

### **æ­¥éª¤ 2: å¯åŠ¨ Electron**
```bash
node ./node_modules/electron/cli.js .
```

**ä½œç”¨**: å¯åŠ¨ Electron åº”ç”¨

**ç­‰ä»·äº**: `electron .` (è¿è¡Œå½“å‰ç›®å½•çš„ Electron åº”ç”¨)

**Electron ä¼šåšä»€ä¹ˆï¼Ÿ**
1. è¯»å– `package.json` çš„ `main` å­—æ®µ
2. æ‰¾åˆ°å…¥å£æ–‡ä»¶: `src/index.js`
3. åœ¨ Node.js ç¯å¢ƒä¸­æ‰§è¡Œ `index.js`

---

### **æ­¥éª¤ 3: ä¸»è¿›ç¨‹åˆå§‹åŒ–** (`src/index.js`)

```javascript
// 1. åˆå§‹åŒ–æ•°æ®åº“
await databaseInitializer.initialize();

// 2. åˆå§‹åŒ–è®¤è¯æœåŠ¡
await authService.initialize();

// 3. åˆå§‹åŒ–æ¨¡å‹çŠ¶æ€æœåŠ¡
await modelStateService.initialize();

// 4. åˆ›å»º Electron çª—å£
createMainOnlyWindow();
```

**å…³é”®ç‚¹**:
- âœ… **ä¸å¯åŠ¨ä»»ä½• Web æœåŠ¡å™¨**
- âœ… æ‰€æœ‰é€šä¿¡é€šè¿‡ IPC (è¿›ç¨‹é—´é€šä¿¡)
- âœ… çª—å£ç›´æ¥åŠ è½½æœ¬åœ° HTML æ–‡ä»¶

---

### **æ­¥éª¤ 4: åˆ›å»ºçª—å£** (`src/window/windowManager.js`)

```javascript
// åˆ›å»ºä¸»çª—å£
const header = new BrowserWindow({
    width: 353,
    height: 47,
    frame: false,
    transparent: true,
    // ...
});

// åŠ è½½æœ¬åœ° HTML æ–‡ä»¶
header.loadFile(path.join(__dirname, '../ui/app/header.html'));
```

**çª—å£ç±»å‹**:
- `header` - ä¸»æ§åˆ¶çª—å£
- `listen` - è¯­éŸ³è¯†åˆ«çª—å£
- `ask` - AI å¯¹è¯çª—å£
- `settings` - è®¾ç½®çª—å£

---

## ğŸ—ï¸ åº”ç”¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Electron åº”ç”¨ (æ¡Œé¢åº”ç”¨)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ä¸»è¿›ç¨‹       â”‚  IPC   â”‚  æ¸²æŸ“è¿›ç¨‹     â”‚      â”‚
â”‚  â”‚  (Node.js)   â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚  (Chromium)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚                         â”‚               â”‚
â”‚       â”‚                         â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ æ•°æ®åº“    â”‚             â”‚ UI ç»„ä»¶   â”‚         â”‚
â”‚  â”‚ æœåŠ¡      â”‚             â”‚ (HTML/JS) â”‚         â”‚
â”‚  â”‚ AI æ¨¡å‹   â”‚             â”‚           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ†š å¯¹æ¯”ï¼šElectron vs Web æœåŠ¡å™¨

### **Electron åº”ç”¨ (ç°åœ¨)**
```
å¯åŠ¨: npm start
è¿›ç¨‹: Electron (æ¡Œé¢åº”ç”¨)
UI: æœ¬åœ° HTML æ–‡ä»¶
é€šä¿¡: IPC (è¿›ç¨‹é—´é€šä¿¡)
ç«¯å£: æ— éœ€ç«¯å£
è®¿é—®: æ¡Œé¢çª—å£
```

### **Web æœåŠ¡å™¨ (ä¹‹å‰æœ‰ï¼Œç°å·²ç§»é™¤)**
```
å¯åŠ¨: npm run dev
è¿›ç¨‹: Node.js + Express
UI: HTTP æœåŠ¡å™¨
é€šä¿¡: HTTP API
ç«¯å£: 3000, 8080
è®¿é—®: æµè§ˆå™¨ (localhost:3000)
```

---

## ğŸ“ æ–‡ä»¶åŠ è½½æ–¹å¼

### **ä¸»çª—å£ (header)**
```javascript
header.loadFile('src/ui/app/header.html')
```
â†“ åŠ è½½
```html
<script src="../../../public/build/header.js"></script>
```
â†“ åŒ…å«
```javascript
// HeaderController.js (å·²ç¼–è¯‘)
// WelcomeHeader.js
// ApiKeyHeader.js
// MainHeader.js
```

### **å†…å®¹çª—å£ (listen/ask/settings)**
```javascript
listen.loadFile('src/ui/app/content.html', { query: { view: 'listen' } })
```
â†“ åŠ è½½
```html
<script src="../../../public/build/content.js"></script>
```
â†“ åŒ…å«
```javascript
// PickleGlassApp.js (å·²ç¼–è¯‘)
// ListenView.js
// AskView.js
// SettingsView.js
```

---

## ğŸ¯ æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **åº”ç”¨ç±»å‹** | Electron æ¡Œé¢åº”ç”¨ |
| **è¿è¡Œç¯å¢ƒ** | Node.js + Chromium |
| **UI æŠ€æœ¯** | HTML + JavaScript (Web Components) |
| **é€šä¿¡æ–¹å¼** | IPC (è¿›ç¨‹é—´é€šä¿¡) |
| **ç½‘ç»œéœ€æ±‚** | æ— éœ€ç½‘ç»œ (é™¤äº† AI API è°ƒç”¨) |
| **ç«¯å£å ç”¨** | æ—  |
| **è®¿é—®æ–¹å¼** | æ¡Œé¢çª—å£ (ä¸æ˜¯æµè§ˆå™¨) |

**å…³é”®ç‚¹**: è¿™æ˜¯ä¸€ä¸ª**å®Œå…¨ç‹¬ç«‹çš„æ¡Œé¢åº”ç”¨**ï¼Œä¸ä¾èµ–ä»»ä½• Web æœåŠ¡å™¨ï¼
